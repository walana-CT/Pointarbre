// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           Int       @id @default(autoincrement())
  email        String    @unique
  name         String?
  passwordHash String
  role         Role      @default(OUVRIER)
  isDisabled   Boolean   @default(false)
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  sessions     Session[]

  ut           Ut[]       @relation("UserUTs")
  agenceId     String?
  agence       Agence?    @relation(fields: [agenceId], references: [id])
  chantiers    Chantier[]

  @@map("user")
}

model Session {
  id        Int      @id @default(autoincrement())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId    Int
  tokenHash String   @unique
  expiresAt DateTime
  createdAt DateTime @default(now())

  @@map("session")
}

enum Role {
  ADMIN
  CMO
  OUVRIER
}

model Agence {
  id    String @id @default(cuid())
  name  String
  uts   Ut[]   @relation("AgenceUTs")
  users User[]

  @@map("agence")
}

model Ut {
  id      String   @id @default(cuid())
  number  String
  name     String  @unique
  agences Agence[] @relation("AgenceUTs")
  users   User[]   @relation("UserUTs")

  @@map("ut")
}

model Triage {
  id     String  @id @default(cuid())
  name   String  @unique
  forets Foret[]

  @@map("triage")
}

model Foret {
  id   String @id @default(cuid())
  name String @unique

  triageId String
  triage   Triage @relation(fields: [triageId], references: [id])

  parcelles Parcelle[]

  @@map("foret")
}

model Parcelle {
  id      String @id @default(cuid())
  name    String
  foretId String
  foret   Foret  @relation(fields: [foretId], references: [id])

  @@map("parcelle")
}

model Chantier {
  id           String    @id @default(cuid())
  date_debut   DateTime
  date_fin     DateTime?
  foret        String
  triage       String
  parcelle     String

  userId Int
  user   User @relation(fields: [userId], references: [id], onDelete: Cascade)

  jours Jour[]

  @@map("chantier")
}

model Jour {
  id String @id @default(cuid())

  chantierId String
  chantier   Chantier @relation(fields: [chantierId], references: [id], onDelete: Cascade)

  phases             Phase[]
  date               DateTime
  h_rendement        Int?
  location_materiel  Int?
  ind_kilometrique   Int?
  transport_materiel Boolean
  panier             Boolean

  @@map("jour")
}

model TypePhase {
  id          String  @id @default(cuid())
  name        String  @unique
  description String?

  @@map("type_phase")
}

model Phase {
  id String @id @default(cuid())

  jourId String
  jour   Jour   @relation(fields: [jourId], references: [id], onDelete: Cascade)

  type  String
  duree DateTime

  @@map("phase")
}
